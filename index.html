<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è‹±æ–‡ç™¼éŸ³ç·´ç¿’</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f5f7fb;
  margin: 0;
  padding: 20px;
  text-align: center;
}

h1 { font-size: 28px; }

button {
  font-size: 20px;
  padding: 14px 20px;
  margin: 8px;
  border-radius: 14px;
  border: none;
  cursor: pointer;
}

.unit-btn {
  width: 90%;
  background: #5b8cff;
  color: white;
}

.card {
  background: white;
  border-radius: 20px;
  padding: 30px;
  max-width: 420px;
  margin: 20px auto;
  box-shadow: 0 8px 20px rgba(0,0,0,.08);
}

.word { font-size: 36px; font-weight: bold; }
.zh { font-size: 24px; margin-top: 6px; }

.progress {
  font-size: 18px;
  color: #666;
  margin-bottom: 10px;
}

.feedback {
  font-size: 22px;
  margin-top: 12px;
}

.recording {
  color: red;
  font-size: 20px;
  margin-top: 10px;
}

.star {
  font-size: 28px;
}

.back-btn { background: #eee; }
</style>
</head>

<body>

<h1>ğŸ“š é¸æ“‡å–®å…ƒ</h1>
<div id="unitMenu"></div>
<div id="app"></div>

<audio id="cheer" src="https://actions.google.com/sounds/v1/crowds/applause.ogg"></audio>

<script>
/* ===== å–®å­—è³‡æ–™ï¼ˆç›®å‰å¯å…ˆé€™æ¨£ï¼Œä¹‹å¾Œå¯æ¥ Sheetï¼‰ ===== */
const data = [
  { unit: 1, title: "è¡£æœï¼ˆä¸€ï¼‰", en: "late", zh: "é²åˆ°çš„" },
  { unit: 1, title: "è¡£æœï¼ˆä¸€ï¼‰", en: "sweater", zh: "æ¯›è¡£" },
  { unit: 1, title: "è¡£æœï¼ˆä¸€ï¼‰", en: "shirt", zh: "è¥¯è¡«" },

  { unit: 2, title: "è¡£æœï¼ˆäºŒï¼‰", en: "jeans", zh: "ç‰›ä»”è¤²" },
  { unit: 2, title: "è¡£æœï¼ˆäºŒï¼‰", en: "shorts", zh: "çŸ­è¤²" },
  { unit: 2, title: "è¡£æœï¼ˆäºŒï¼‰", en: "pants", zh: "é•·è¤²" }
];

let words = [];
let index = 0;

/* ===== é¸å–® ===== */
function showMenu() {
  document.getElementById("app").innerHTML = "";
  const menu = document.getElementById("unitMenu");
  menu.innerHTML = "";

  const units = [...new Map(data.map(d => [d.unit, d.title]))];
  units.forEach(([u, title]) => {
    const btn = document.createElement("button");
    btn.className = "unit-btn";
    btn.textContent = title;
    btn.onclick = () => startUnit(u);
    menu.appendChild(btn);
  });
}

/* ===== é–‹å§‹å–®å…ƒ ===== */
function startUnit(u) {
  words = data.filter(d => d.unit === u);
  index = 0;
  document.getElementById("unitMenu").innerHTML = "";
  showCard();
}

/* ===== é¡¯ç¤ºå¡ç‰‡ ===== */
function showCard() {
  if (index >= words.length) {
    document.getElementById("app").innerHTML = `
      <h2>ğŸ‰ å…¨éƒ¨å®Œæˆï¼</h2>
      <div class="star">â­â­â­â­â­</div>
      <button class="back-btn" onclick="showMenu()">ğŸ”™ å›åˆ°é¸å–®</button>
    `;
    document.getElementById("cheer").play();
    return;
  }

  const w = words[index];
  document.getElementById("app").innerHTML = `
    <div class="card">
      <div class="progress">ç¬¬ ${index+1} é¡Œ / å…± ${words.length} é¡Œ</div>

      <div class="word">${w.en}</div>
      <div class="zh">${w.zh}</div>

      <button onclick="speak('${w.en}')">ğŸ”Š è½ç™¼éŸ³</button>
      <button onclick="record()">ğŸ¤ æˆ‘ä¾†å¿µ</button>

      <div id="status"></div>
      <div id="result" class="feedback"></div>

      <button onclick="next()">ä¸‹ä¸€é¡Œ</button><br>
      <button class="back-btn" onclick="showMenu()">ğŸ”™ å›åˆ°é¸å–®</button>
    </div>
  `;
}

/* ===== ç™¼éŸ³ ===== */
function speak(t) {
  speechSynthesis.cancel();
  speechSynthesis.speak(new SpeechSynthesisUtterance(t));
}

/* ===== éŒ„éŸ³ï¼‹è©•åˆ† ===== */
function record() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("æ­¤è£ç½®ä¸æ”¯æ´èªéŸ³è¾¨è­˜");
    return;
  }

  const statusEl = document.getElementById("status");
  const resultEl = document.getElementById("result");

  const rec = new SpeechRecognition();
  rec.lang = "en-US";

  statusEl.innerHTML = `<div class="recording">ğŸ”´ éŒ„éŸ³ä¸­â€¦è«‹èªªè©±</div>`;
  resultEl.innerHTML = "";

  rec.start();

  rec.onresult = e => {
    statusEl.innerHTML = "";
    const said = e.results[0][0].transcript.toLowerCase();
    const answer = words[index].en.toLowerCase();

    let stars = "â­";
    let msg = "ğŸ’ª å†è©¦è©¦çœ‹ï¼";

    if (said.includes(answer)) {
      stars = "â­â­â­";
      msg = "ğŸ‰ ä½ å¾ˆæ£’ï¼";
    } else if (answer.includes(said) || similarity(said, answer) > 0.5) {
      stars = "â­â­";
      msg = "ğŸ™‚ å·®ä¸€é»ï¼Œå†è©¦è©¦çœ‹ï¼";
    }

    resultEl.innerHTML = `
      <div class="star">${stars}</div>
      <div>${msg}</div>
      <div>ğŸ—£ æˆ‘è½èµ·ä¾†åƒï¼š${said}</div>
    `;
  };
}

/* ===== ä¸‹ä¸€é¡Œ ===== */
function next() {
  index++;
  showCard();
}

/* ===== ç°¡æ˜“ç›¸ä¼¼åº¦ ===== */
function similarity(a, b) {
  let same = 0;
  for (let i = 0; i < Math.min(a.length, b.length); i++) {
    if (a[i] === b[i]) same++;
  }
  return same / Math.max(a.length, b.length);
}

/* åˆå§‹ */
showMenu();
</script>

</body>
</html>
