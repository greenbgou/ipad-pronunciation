<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>è‹±æ–‡ç™¼éŸ³ç·´ç¿’</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f5f7fb;
  margin: 0;
  padding: 20px;
  text-align: center;
}

button {
  font-size: 20px;
  padding: 14px 20px;
  margin: 8px;
  border-radius: 14px;
  border: none;
}

.unit-btn {
  width: 90%;
  background: #5b8cff;
  color: white;
}

.card {
  background: white;
  border-radius: 20px;
  padding: 30px;
  max-width: 420px;
  margin: 20px auto;
}

.word { font-size: 36px; font-weight: bold; }
.zh { font-size: 24px; }
.progress { font-size: 18px; color: #555; }

.back-btn { background: #eee; }
</style>
</head>

<body>

<h1>ğŸ“š é¸æ“‡å–®å…ƒ</h1>
<div id="unitMenu"></div>
<div id="app"></div>

<audio id="cheer" src="https://actions.google.com/sounds/v1/crowds/applause.ogg"></audio>

<script>
const SHEET_ID = "1q3_RdZns6MIOL_WYZdUArXi-cy-98VLsdXP3YEEKUeg";
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

let allData = [];
let words = [];
let index = 0;

/* è®€å– Google Sheet */
fetch(CSV_URL)
  .then(r => r.text())
  .then(text => {
    const rows = text.split("\n").slice(1);
    allData = rows.map(r => {
      const [unit, title, en, zh, order] = r.split(",");
      return { unit, title, en, zh, order };
    });
    showMenu();
  });

function showMenu() {
  const menu = document.getElementById("unitMenu");
  menu.innerHTML = "";

  const units = {};
  allData.forEach(d => units[d.unit] = d.title);

  Object.entries(units).forEach(([u, title]) => {
    const btn = document.createElement("button");
    btn.className = "unit-btn";
    btn.textContent = title;
    btn.onclick = () => startUnit(u);
    menu.appendChild(btn);
  });
}

function startUnit(u) {
  words = allData.filter(d => d.unit === u);
  index = 0;
  document.getElementById("unitMenu").innerHTML = "";
  showCard();
}

function showCard() {
  if (index >= words.length) {
    document.getElementById("app").innerHTML = `
      <h2>ğŸ‰ å…¨éƒ¨å®Œæˆï¼</h2>
      <button class="back-btn" onclick="location.reload()">ğŸ”™ å›é¸å–®</button>
    `;
    document.getElementById("cheer").play();
    return;
  }

  const w = words[index];
  document.getElementById("app").innerHTML = `
    <div class="card">
      <div class="progress">ç¬¬ ${index+1} é¡Œ / å…± ${words.length} é¡Œ</div>
      <div class="word">${w.en}</div>
      <div class="zh">${w.zh}</div>

      <button onclick="speak('${w.en}')">ğŸ”Š è½ç™¼éŸ³</button>
      <button onclick="record()">ğŸ¤ æˆ‘ä¾†å¿µ</button>
      <div id="result"></div>

      <button onclick="next()">ä¸‹ä¸€é¡Œ</button><br/>
      <button class="back-btn" onclick="location.reload()">ğŸ”™ å›é¸å–®</button>
    </div>
  `;
}

function speak(t) {
  speechSynthesis.speak(new SpeechSynthesisUtterance(t));
}

function record() {
  const R = window.SpeechRecognition || window.webkitSpeechRecognition;
  const r = new R();
  r.lang = "en-US";
  r.start();
  r.onresult = e => {
    const said = e.results[0][0].transcript.toLowerCase();
    document.getElementById("result").innerText = "ğŸ—£ï¸ æˆ‘è½èµ·ä¾†åƒï¼š" + said;
  };
}

function next() {
  index++;
  showCard();
}
</script>

</body>
</html>
